# Авиахакатон МАИ 2022

В данном проекте представлена реализация системы управления пассажирскими автобусами в аэропорту. В проекте присутствует Web-сервис для диспетчера, мобильное приложение для самих водителей, связующий их бэкенд и алгоритм автоматического оптимизированного распределения задач между водителями.

![https://img.shields.io/badge/golang-1.19.2-blue](https://img.shields.io/badge/golang-1.19.2-blue) ![https://img.shields.io/badge/PostgreSQL-15-lightgrey](https://img.shields.io/badge/PostgreSQL-15-lightgrey) ![https://img.shields.io/badge/Dart-2.18-orange](https://img.shields.io/badge/Dart-2.18-orange) ![https://img.shields.io/badge/flutter-3.3.5-green](https://img.shields.io/badge/flutter-3.3.5-green) ![https://img.shields.io/badge/JavaScript-1.8.5-ff69b4](https://img.shields.io/badge/JavaScript-1.8.5-ff69b4) ![https://img.shields.io/badge/React-18-blueviolet](https://img.shields.io/badge/React-18-blueviolet)

## Оглавление

1. [Структура проекта](#Структура-проекта)
2. [JavaScript](#JavaScript)
3. [Flutter (Mobile)](#Flutter)
4. [Golang](#Golang)
5. [Кто работал над проектом](#Над-проектом-работали)
    
## Структура проекта

Проект состоит из 3-ех частей:
- Web frontend, написанный на JavaScript
- Mobile frontend, написанный с помощью фреймворка Flutter
- Golang Server

## JavaScript

Для запуска проекта в режиме разработчика необходимо выполнить команду `npm start`. Страница в браузере по адресу "localhost:3000" будет автоматически обновляться при изменении проекта.

Основная папка src содержит само приложение App.js, которое использует страницы pages. Страницы используют компоненты components.

Все зависимости содержатся в файле package.json.

## Flutter
Для запуска проекта в режиме дебаг требуется Flutter SDK, Dart SDK, Android SDK и эмулятор устройства Android/IOS. Для установки релизной версиии на устройство Android достаточно установить сгенерированный файл с расширением .apk (находится в корневой папке, устанавливается только на планшеты с OC Android).

В проекте представлена следующая структура директорий:
- assets - все ассеты (png, svg, lottie)
- pages - экраны
- widgets - виджеты, используемые на разных экранах
- utils - вспомогательные функции и классы (пр. класс текстовых стилей)
- controllers - контроллеры GetX
- navigation - хранилище класса AutoRouter и его генерация

Используемые пакеты:
- AutoRoute - настройки навигации
- GetX - реализация реактивного стейт-менеджмента
- RxDart - работа с потоками
- SharedPreferences - хранение данных в памяти устройства
- GoogleFonts - текстовые стили от компании Google
- FlutterSvg - работа с векторными изображениями в формате .svg
- Lottie - работа с Lottie-анимациями
- Bounce - реализация анимации нажатия на кнопки

Работа с приложением:
1. Прохождение регистрации путем ввода имени и выданного диспетчером ID пользователя. Если хотя бы одно поле не заполнено, не произойдет переход на главный экран и появится сообщение об ошибке;
2. На главном экране в правой верхней части происходит основное взаимодействие. Показывается описание текущего задания водителя в полной форме или другая информация;
3. У водителя есть возможность указать начало и окончание выполнения задания. Данная информация отправляется на бэкенд;
4. В левой части главного экрана предоставлен скролящийся список задач, идущих после текущей в порядке очереди. Каждая задача расписана в краткой форме;
5. Дополнительно в нижней правой части экрана присутствует меню, позволяющее водителю взять перерыв, связаться с диспетчером в случае форс-мажора и выход из аккаунта по истечении рабочего дня. При нажатии на одну из трех опций на экране всплывает меню подтверждения;
6. При подтверждении опции "взятия перерыва", на главном экране можно видеть отсчёт оставшегося времени. По истечении данного времени или при нажатии на кнопку "Продолжить работу" водителю требуется указать текущее местоположение для корректного продолжения работы алгоритма выдачи заданий;
7. Допольнительно представлены EmptyState списка задач, LoadingState загрузки задач при запросе с бэкенда, SplashScreen с анимацией при запуске приложения.

## Golang
Для запуска сервера необходимо выполнить команды:
```
cd server
go run cmd/bus-managment/main.go
``` 
Сервер при запуске выполняет подключение к хранилищам: flights - список рейсов, buses - список автобусов, tasks - список задач. В данном проекте хранилища реализованы на PostgreSQL в виде таблиц.
На основе первых 2 таблиц раз в пол часа выполняется генерация задач, которые отправляются таблицу с задачами.
После генерации задач, диспетчер может изменить время, статус и автобус для конкретной задачи. 
Водитель также может изменять статус задачи (в работе, на паузе, завершена, в очереди).
Список задач регулярно обновляется в приложениях у диспетчера и водителя (т.е. регулярно отправляется запрос к серверу).

Методы api:
1. get-tasks (GET) - получение списка задач. Если отправить запрос без параметра, то будут отправлены все активные задачи. Если указать параметр busID, то будут отправлены активные задачи для указанного автобуса.
2. change-task (POST) - изменение задачи. В запросе необходимы следующие параметры: taskID, type (тип изменяемого параметра), value (новое значение для изменяемого параметра).

Алгоритм формирования задач:
```
Цикл по всем активным автобусам: 
    Создаем переменные: список задач, время последней задачи автобуса, локация последней задачи автобуса
    Находим ближайший по времени рейс, на который успевает автобус (используем граф для подсчета расстояния и времени)
    Добавляем задачу автобусу, меняем его время и позицию.
    Из количества пассажиров рейса вычитаем количество пассажиров автобусов
    Если пассажиров больше не осталось, больше не учитываем этот рейс
    Если нет задачи, удовлетворяющей автобусу, то переходим с следующему
```
Минимальные расстояния между всеми точками высчитывается заранее и в сложность алгоритма не входит.
Сложность алгоритма: O(n*m), где n - число автобусов, m - число рейсов

## Над проектом работали
- Скурихин Григорий - https://github.com/GrishaSkurikhin/
- Псеунов Дамир - https://github.com/DPseunoff/
- Васильев Александр - https://github.com/bac1lla/
- Баталин Дмитрий - https://github.com/DABatalin/
- Хвошнянская Елизавета - https://github.com/LizaKhvoshnyanskaya/
